<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <!--<script src="cordova.js"></script>-->
        <script src="kendo/js/jquery-1.8.3.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="jaydata/jaydata.min.js"></script>
        <script src="jaydata/jaydatamodules/kendo.js"></script>
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />
    </head>
    <body>
        <div data-role="view" id="tabstrip-home" data-model="viewModel" data-title="Hello World!">
            <h1>Welcome!</h1>
            <div id="database_result"></div>
            <h3>Cart database</h3>
            <ul id="listView"
                data-role="listview"
                data-style="inset"
                data-template="item-template"
                data-bind="source: items, events: { click: removeItem }">
            </ul>
        </div>

    	<script id="item-template" type="text/x-kendo-template">
            <span data-bind="text:ProductName"></span> (<span data-bind="text:Amount"></span>) - 
            <span>Tap to remove</span>
    	</script>
        
        <script>
            $data.define("Cart", {
                ProductName: String,
                Amount: Number
            });
            
            viewModel = kendo.observable({
               items: [],
               displayCart: function() {
                    $data("Cart").readAll().then(function(items) {
                        viewModel.items.splice(0, viewModel.items.length);
                        items.forEach(function(item) {
                            viewModel.items.push(item.asKendoObservable());
                        });
                    });
               },
                addNewItem: function() {
                     return ;
                },
                removeItem: function(e) {
                    e.item.css("color","silver");
                    e.dataItem.innerInstance().remove().then(function() {
                       $data("Cart").readAll().then(viewModel.displayCart); 
                    });
                }
            });
            
            var app = new kendo.mobile.Application(document.body, { transition: "slide" });
            
           
            $data("Cart")
            .save({ProductName: "White tea", Amount: Math.random().toString().substr(2,2) })
            .then(function() {
                $('#database_result').html('Database successfully created. Test item inserted');
            })
            .then(viewModel.displayCart)
            .fail(function() {
                $('#database_result').html('Error creating database or writing data');
            });
    </script>
    </body>
</html>
